
import serial
import sys
import time
import threading


def send_data(s_obj, data):
    send_result = s_obj.write(data)
    print('send_result=' + str(send_result))


def receive_reply():

    while True:
        count = serial_obj.inWaiting()
        if count > 0:
            print('count=' + str(count))
            data = serial_obj.read(count)
            if data == b'':
                time.sleep(0.5)
                continue
            print('data=' + str(data))
            if str(data).find('jexit') != -1:
                break

            if str(data).find('no space') != -1:
                print('no space occur.')
                break
        time.sleep(0.1)

    serial_obj.close()


if __name__ == '__main__':
    serial_obj = serial.Serial('COM3', 115200)
    if serial_obj.isOpen():
        print('open success.')
    else:
        print('open fail.')
        sys.exit(1)

    t = threading.Thread(target=receive_reply)
    t.start()

    data_1 = bytes([0x4D, 0x43, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00])
    send_data(serial_obj, data_1)
    data_2 = bytes([0x4D, 0x43, 0x01, 0x02, 0x01, 0x00, 0x00, 0x00, 0x4D])
    send_data(serial_obj, data_2)
    data_3 = bytes([0x4D, 0x43, 0x01, 0x03, 0x05, 0x00, 0x00, 0x00, 0x41, 0x42, 0x43, 0x44, 0x45])
    send_data(serial_obj, data_3)
    data_4 = bytes([0x4D, 0x43, 0x01, 0x03, 0x05, 0x00, 0x00, 0x00, 0x46, 0x47, 0x48, 0x49, 0x4A])
    send_data(serial_obj, data_4)
    data_5 = bytes([0x4D, 0x43, 0x01, 0x03, 0x05, 0x00, 0x00, 0x00, 0x4B, 0x4C, 0x4D, 0x4E, 0x4F])
    send_data(serial_obj, data_5)
    data_6 = bytes([0x4D, 0x43, 0x01, 0x03, 0x05, 0x00, 0x00, 0x00, 0x50, 0x51, 0x52, 0x53, 0x54])
    send_data(serial_obj, data_6)
    data_7 = bytes([0x4D, 0x43, 0x01, 0x03, 0x05, 0x00, 0x00, 0x00, 0x30, 0x31, 0x32, 0x33, 0x34])
    send_data(serial_obj, data_7)
    data_8 = bytes([0x4D, 0x43, 0x01, 0x03, 0x05, 0x00, 0x00, 0x00, 0x35, 0x36, 0x37, 0x38, 0x39])
    send_data(serial_obj, data_8)
    data_9 = bytes([0x4D, 0x43, 0x01, 0x03, 0x05, 0x00, 0x00, 0x00, 0x61, 0x62, 0x63, 0x64, 0x65])
    send_data(serial_obj, data_9)
    data_10 = bytes([0x4D, 0x43, 0x01, 0x03, 0x05, 0x00, 0x00, 0x00, 0x66, 0x67, 0x68, 0x69, 0x6A])
    send_data(serial_obj, data_10)
    data_11 = bytes([0x4D, 0x43, 0x01, 0x03, 0x05, 0x00, 0x00, 0x00, 0x6B, 0x6C, 0x6D, 0x6E, 0x6F])
    send_data(serial_obj, data_11)
    # receive_reply()
